import { computed, reactive, ref, watch } from 'vue'
import { useVuelidate } from "@vuelidate/core";
import { required, helpers, minValue } from "@vuelidate/validators";
import type { <%= tableDetailCurrent.tableNameSingularUCamelCase %> } from "../../types/<%= tableDetailCurrent.tableNameSingularUCamelCase %>";

export default (<%= tableDetailCurrent.tableNameSingular %>: <%= tableDetailCurrent.tableNameSingularUCamelCase %>) => {  
  const form = reactive<<%= tableDetailCurrent.tableNameSingularUCamelCase %>>({<%
    tableDetailCurrent.tableStructureOfDetails[0].filter(
        f => !['created_at', 'updated_at', 'deleted_at'].includes(f.column_name)
    ).forEach(function(field){ %>
    <%= field.column_name; %>: <%= tableDetailCurrent.tableNameSingular %>.<%= field.column_name; %>, %><% }); %>
  })

  const isOpenModal = ref(false)

  const rules = computed(() => {
    return {<%
      tableDetailCurrent.tableStructureOfDetails[0].filter(
          f => !['id', 'created_at', 'updated_at', 'deleted_at'].includes(f.column_name)
      ).forEach(function(field){ %>
      <%= field.column_name; %>: { required: helpers.withMessage("Campo requerido", required) },<% }); %>
    };
  });

  const v$ = useVuelidate(rules, form);
    
  watch(<%= tableDetailCurrent.tableNameSingular %>, (new<%= tableDetailCurrent.tableNameSingularUCamelCase %>) => {<%
    tableDetailCurrent.tableStructureOfDetails[0].filter(
      f => !['id', 'created_at', 'updated_at', 'deleted_at'].includes(f.column_name)
    ).forEach(function(field){ %>
    form.<%= field.column_name; %> = new<%= tableDetailCurrent.tableNameSingularUCamelCase %>.<%= field.column_name; %><% }); %>
  })

  return {
    form,
    
    v$ 
  }
}
